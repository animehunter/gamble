<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>5&nbsp;Samplers and Solvers</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Gamble:<span class="mywbr"> &nbsp;</span> Probabilistic Programming</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="dist.html" class="tocviewlink" data-pltdoc="x">Probability Distributions</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="primitive.html" class="tocviewlink" data-pltdoc="x">Primitive Stochastic Functions</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="features.html" class="tocviewlink" data-pltdoc="x">Derived Stochastic Forms and Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="solvers.html" class="tocviewselflink" data-pltdoc="x">Samplers and Solvers</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="util.html" class="tocviewlink" data-pltdoc="x">Utilities</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="viz.html" class="tocviewlink" data-pltdoc="x">Visualization Utilities</a></td></tr><tr><td align="right"></td><td><a href="prob-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="solvers.html" class="tocviewselflink" data-pltdoc="x">Samplers and Solvers</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="solvers.html#%28part._sampler-funs%29" class="tocviewlink" data-pltdoc="x">Basic Sampler Functions</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="solvers.html#%28part._samplers-basic%29" class="tocviewlink" data-pltdoc="x">Basic Sampler Forms</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="solvers.html#%28part._mh-sampler%29" class="tocviewlink" data-pltdoc="x">Metropolis-<wbr></wbr>Hastings Sampler and Transitions</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="solvers.html#%28part._particles%29" class="tocviewlink" data-pltdoc="x">Particle Filters</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="solvers.html#%28part._enum%29" class="tocviewlink" data-pltdoc="x">Enumeration Solver</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._sampler-funs%29" class="tocsubseclink" data-pltdoc="x">Basic Sampler Functions</a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._sampler~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sampler?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._weighted-sampler~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">weighted-<wbr></wbr>sampler?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._generate-samples%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">generate-<wbr></wbr>samples</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._generate-weighted-samples%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">generate-<wbr></wbr>weighted-<wbr></wbr>samples</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._sampler-~3ediscrete-dist%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sampler-<wbr></wbr>&gt;discrete-<wbr></wbr>dist</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._samplers-basic%29" class="tocsubseclink" data-pltdoc="x">Basic Sampler Forms</a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">rejection-<wbr></wbr>sampler</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._importance-sampler%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">importance-<wbr></wbr>sampler</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._mh-sampler%29" class="tocsubseclink" data-pltdoc="x">Metropolis-<wbr></wbr>Hastings Sampler and Transitions</a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">mh-<wbr></wbr>sampler</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._hmc-sampler%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">hmc-<wbr></wbr>sampler</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.3.1<tt>&nbsp;</tt></span><a href="#%28part._mh-transitions%29" class="tocsubseclink" data-pltdoc="x">Metropolis-<wbr></wbr>Hastings Transitions</a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mh-<wbr></wbr>transition?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._single-site%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">single-<wbr></wbr>site</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._multi-site%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">multi-<wbr></wbr>site</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._slice%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">slice</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._enumerative-gibbs%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">enumerative-<wbr></wbr>gibbs</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._hmc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">hmc</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._cycle%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">cycle</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._mixture%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mixture</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._rerun%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">rerun</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.3.2<tt>&nbsp;</tt></span><a href="#%28part._mh-proposals%29" class="tocsubseclink" data-pltdoc="x">Metropolis-<wbr></wbr>Hastings Proposals</a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">proposal?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3aresample%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">proposal:<span class="mywbr"> &nbsp;</span>resample</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3adrift%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">proposal:<span class="mywbr"> &nbsp;</span>drift</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._default-proposal%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">default-<wbr></wbr>proposal</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.3.3<tt>&nbsp;</tt></span><a href="#%28part._mh-zones%29" class="tocsubseclink" data-pltdoc="x">Zones:<span class="mywbr"> &nbsp;</span> Identifying Random Choices</a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._with-zone%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">with-<wbr></wbr>zone</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.3.4<tt>&nbsp;</tt></span><a href="#%28part._hmc-utils%29" class="tocsubseclink" data-pltdoc="x">Specifying Derivatives for HMC</a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">derivative</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.4<tt>&nbsp;</tt></span><a href="#%28part._particles%29" class="tocsubseclink" data-pltdoc="x">Particle Filters</a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._make-particles%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>particles</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-count%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>count</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-update%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>update</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-score%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>score</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-resample%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>resample</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-effective-count%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>effective-<wbr></wbr>count</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-effective-ratio%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>effective-<wbr></wbr>ratio</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-weighted-states%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>weighted-<wbr></wbr>states</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-states%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">particles-<wbr></wbr>states</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._gamble%2Fmain..rkt%29._in-particles%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">in-<wbr></wbr>particles</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.5<tt>&nbsp;</tt></span><a href="#%28part._enum%29" class="tocsubseclink" data-pltdoc="x">Enumeration Solver</a></td></tr><tr><td><a href="#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">enumerate</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="features.html" title="backward to &quot;4 Derived Stochastic Forms and Functions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Gamble: Probabilistic Programming&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="util.html" title="forward to &quot;6 Utilities&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>5<tt>&nbsp;</tt><a name="(part._solvers)"></a>Samplers and Solvers</h3><p>The point of writing a generate model is typically not to simply run
it to generate data, but rather to do <span style="font-style: italic">inference</span> on it&#8212;<wbr></wbr>for
example, to estimate parameters given observed data. This requires
wrapping the model in a <a href="solvers.html#%28tech._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">sampler</span></a> or <a href="solvers.html#%28tech._solver%29" class="techoutside" data-pltdoc="x"><span class="techinside">solver</span></a> of some sort.</p><p>A <a name="(tech._sampler)"></a><span style="font-style: italic">sampler</span> is an object that contains a probabilistic program
and produces samples from the posterior distribution of its result
expression. Samplers can be either unweighted (where each sample is
equally representative of the posterior distribution) or
<a name="(tech._weighted._sampler)"></a><span style="font-style: italic">weighted</span> (where each sample comes
with a factor that corrects for the ratio of its sampling frequency
and its probability in the posterior distribution).</p><p><div class="SIntrapara">The following samplers are supported:
</div><div class="SIntrapara"><ul><li><p><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="RktStxLink" data-pltdoc="x">rejection-sampler</a></span> &#8212;<wbr></wbr> unweighted sampler, does not
support observations on continuous random variables</p></li><li><p><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._importance-sampler%29%29" class="RktStxLink" data-pltdoc="x">importance-sampler</a></span> &#8212;<wbr></wbr> weighted sampler</p></li><li><p><span class="RktSym">enum-importance-sampler</span> &#8212;<wbr></wbr> weighted sampler</p></li><li><p><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="RktStxLink" data-pltdoc="x">mh-sampler</a></span> &#8212;<wbr></wbr> unweighted sampler, uses MCMC to seek
high-probability zones</p></li></ul></div></p><p><div class="SIntrapara">Aside from <a href="solvers.html#%28tech._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">samplers</span></a>, there are other <a name="(tech._solver)"></a><span style="font-style: italic">solvers</span> that can
extract information from a probabilistic model. The following solvers
are supported:
</div><div class="SIntrapara"><ul><li><p><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span> &#8212;<wbr></wbr> exhaustive enumeration (up to optional
threshold), exponential in number of random variables, cannot handle
sampling from continuous random variables</p></li></ul></div></p><p>The examples in the following sections use the following function
definitions:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-heads</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._zero~3f%29%29" class="RktValLink" data-pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-heads</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">geom</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">geom</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr></table></blockquote><h4>5.1<tt>&nbsp;</tt><a name="(part._sampler-funs)"></a>Basic Sampler Functions</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._sampler~3f))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._sampler~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">sampler?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a <a href="solvers.html#%28tech._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">sampler</span></a>, <span class="RktVal">#f</span>
otherwise.</div></p><p>A sampler is also an applicable object. That is, if <span class="RktVar">s</span> is a
sampler, then evaluating <span class="RktPn">(</span><span class="RktVar">s</span><span class="RktPn">)</span> generates a sample.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._weighted-sampler~3f))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._weighted-sampler~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">weighted-sampler?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a <a href="solvers.html#%28tech._weighted._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">weighted sampler</span></a>,
<span class="RktVal">#f</span> otherwise.</div></p><p>Every <a href="solvers.html#%28tech._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">sampler</span></a> is also a <a href="solvers.html#%28tech._weighted._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">weighted sampler</span></a>; the samples it
produces always have weight <span class="RktVal">1</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._generate-samples))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._generate-samples%29%29" class="RktValDef RktValLink" data-pltdoc="x">generate-samples</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">s</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">n</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:burn</span><span class="hspace">&nbsp;</span><span class="RktVar">burn</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:thin</span><span class="hspace">&nbsp;</span><span class="RktVar">thin</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fvector..rkt%29._vectorof%29%29" class="RktValLink" data-pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._weighted-sampler~3f%29%29" class="RktValLink" data-pltdoc="x">weighted-sampler?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">burn</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">thin</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr></table></blockquote></div><div class="SIntrapara">Generates <span class="RktVar">n</span> samples from the sampler <span class="RktVar">s</span>. If
<span class="RktVar">s</span> is not a sampler but only a weighted sampler, unweighted
samples are produced by residual resampling (see <span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._resample%29%29" class="RktValLink" data-pltdoc="x">resample</a></span>).</div></p><p>The sampler is first called <span class="RktVar">burn</span> times and the results are
discarded. In addition, the sampler is called <span class="RktVar">thin</span> times
before every sample to be retained.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._generate-weighted-samples))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._generate-weighted-samples%29%29" class="RktValDef RktValLink" data-pltdoc="x">generate-weighted-samples</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">s</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">n</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:burn</span><span class="hspace">&nbsp;</span><span class="RktVar">burn</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:thin</span><span class="hspace">&nbsp;</span><span class="RktVar">thin</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fvector..rkt%29._vectorof%29%29" class="RktValLink" data-pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._cons%2Fc%29%29" class="RktValLink" data-pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._~3e~3d%2Fc%29%29" class="RktValLink" data-pltdoc="x">&gt;=/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._weighted-sampler~3f%29%29" class="RktValLink" data-pltdoc="x">weighted-sampler?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">burn</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">thin</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr></table></blockquote></div><div class="SIntrapara">Generates <span class="RktVar">n</span> weighted samples from the <a href="solvers.html#%28tech._weighted._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">weighted sampler</span></a>
<span class="RktVar">s</span> and returns them as a vector of value-weight pairs.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._sampler-~3ediscrete-dist))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._sampler-~3ediscrete-dist%29%29" class="RktValDef RktValLink" data-pltdoc="x">sampler-&gt;discrete-dist</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">sampler</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">n</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktVar">f</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:burn</span><span class="hspace">&nbsp;</span><span class="RktVar">burn</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:thin</span><span class="hspace">&nbsp;</span><span class="RktVar">thin</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="dist.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._discrete-dist~3f%29%29" class="RktValLink" data-pltdoc="x">discrete-dist?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">sampler</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._weighted-sampler~3f%29%29" class="RktValLink" data-pltdoc="x">weighted-sampler?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-positive-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-positive-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">burn</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">thin</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the empirical distribution obtained by generating <span class="RktVar">n</span>
samples from <span class="RktVar">sampler</span>, apply <span class="RktVar">f</span> to each result.</div></p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._sampler-~3ediscrete-dist%29%29" class="RktValLink" data-pltdoc="x">sampler-&gt;discrete-dist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="RktStxLink" data-pltdoc="x">rejection-sampler</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(discrete-dist [#f 0.4] [#t 0.6])</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._sampler-~3ediscrete-dist%29%29" class="RktValLink" data-pltdoc="x">sampler-&gt;discrete-dist</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._importance-sampler%29%29" class="RktStxLink" data-pltdoc="x">importance-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">R</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._binomial%29%29" class="RktValLink" data-pltdoc="x">binomial</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="primitive.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._observe-sample%29%29" class="RktValLink" data-pltdoc="x">observe-sample</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="dist.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._normal-dist%29%29" class="RktValLink" data-pltdoc="x">normal-dist</a></span><span class="hspace">&nbsp;</span><span class="RktSym">R</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">R</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(discrete-dist</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[4 1.0207038325803902e-07]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[5 1.8376166183266965e-05]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[6 0.0006085350484269234]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[7 0.03336063548551825]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[8 0.21596177118385904]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[9 0.3286714761312946]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[10 0.36547376661883846]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[11 0.05189432186636171]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[12 0.0039554778147750025]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[13 5.512849854980089e-05]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[14 4.0828153303215607e-07]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[15 8.342766540240695e-10])</span></p></td></tr></table></td></tr></table></blockquote></td></tr></table></p><h4>5.2<tt>&nbsp;</tt><a name="(part._samplers-basic)"></a>Basic Sampler Forms</h4><p>The samplers supported by this language consist of simple samplers and
a more complicated and flexible
<a href="solvers.html#%28part._mh-sampler%29" data-pltdoc="x">Metropolis-Hastings sampler framework</a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._rejection-sampler))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">rejection-sampler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">def/expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">result-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-when-clause</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-when-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktVar">condition-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Produces a <a href="solvers.html#%28tech._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">sampler</span></a> that, when applied, returns a value of
<span class="RktVar">result-expr</span> arising from an execution where
<span class="RktVar">condition-expr</span>, if present, was satisfied.</div></p><p>The sampler is implemented using rejection sampling&#8212;<wbr></wbr>specifically,
&ldquo;logic sampling&rdquo;&#8212;<wbr></wbr>for discrete random choices. That is, the
<span class="RktVar">def/expr</span>s and <span class="RktVar">result-expr</span> are evaluated. Then
<span class="RktVar">condition-expr</span> is evaluated, if present; if it produces
<span class="RktVal">#t</span>, the execution is accepted and the value of
<span class="RktVar">result-expr</span> is returned; otherwise, the process is repeated.</p><p>The rejection sampler can sample continuous random variables, but it
cannot perform observations (<span class="RktSym"><a href="primitive.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._observe-sample%29%29" class="RktValLink" data-pltdoc="x">observe-sample</a></span>) on them.</p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s-or</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="RktStxLink" data-pltdoc="x">rejection-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">A</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="viz.html#%28def._%28%28lib._gamble%2Fviz..rkt%29._hist%29%29" class="RktValLink" data-pltdoc="x">hist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s-or</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_3.png" alt="image" width="406" height="406"/></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="viz.html#%28def._%28%28lib._gamble%2Fviz..rkt%29._hist%29%29" class="RktValLink" data-pltdoc="x">hist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s-or</span><span class="hspace">&nbsp;</span><span class="RktVal">1000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_4.png" alt="image" width="406" height="406"/></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rs-count-heads</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="RktStxLink" data-pltdoc="x">rejection-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-heads</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">rs-count-heads</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">4</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">rs-count-heads</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="viz.html#%28def._%28%28lib._gamble%2Fviz..rkt%29._hist%29%29" class="RktValLink" data-pltdoc="x">hist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rs-count-heads</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_5.png" alt="image" width="406" height="406"/></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._importance-sampler))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._importance-sampler%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">importance-sampler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">def/expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">result-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-when-clause</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-when-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktVar">condition-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._rejection-sampler%29%29" class="RktStxLink" data-pltdoc="x">rejection-sampler</a></span>, but returns a <span style="font-style: italic">weighted sampler</span>
that uses weights to represent the quality of a particular sample
given the observations in the program. Thus unlike a rejection
sampler, an importance sampler can handle observations
(<span class="RktSym"><a href="primitive.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._observe-sample%29%29" class="RktValLink" data-pltdoc="x">observe-sample</a></span>) on continuous random variables.</div></p><h4>5.3<tt>&nbsp;</tt><a name="(part._mh-sampler)"></a>Metropolis-Hastings Sampler and Transitions</h4><p>Metropolis-Hastings (MH) is an algorithm framework for producing a
correlated sequence of samples where each sample is based on the
previous. The algorithm is parameterized by the mechanism for
proposing a new state given the previous state; given a proposal, the
MH algorithm accepts or rejects it based on how the proposal was
generated and the relative likelihood of the proposed state.</p><p>The <span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="RktStxLink" data-pltdoc="x">mh-sampler</a></span> form implements the Metropolis-Hastings
framework, and the proposal mechanisms are implemented by a variety of
<a name="(tech._mh._transition)"></a><span style="font-style: italic">MH transition</span> types.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._mh-sampler))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">mh-sampler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">def/expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">result-expr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">maybe-when-clause</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">maybe-transition-clause</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-when-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktVar">condition-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-transition-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:transition</span><span class="hspace">&nbsp;</span><span class="RktVar">transition-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="solvers.html#%28tech._sampler%29" class="techoutside" data-pltdoc="x"><span class="techinside">sampler</span></a> that produces samples using a variant of
Metropolis-Hastings.</div></p><p>The <span class="RktVar">transition-expr</span> determines the mechanism used to propose
new states. If absent, <span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._single-site%29%29" class="RktValLink" data-pltdoc="x">single-site</a></span><span class="RktPn">)</span> is used.</p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mh-or</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="RktStxLink" data-pltdoc="x">mh-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">A</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="viz.html#%28def._%28%28lib._gamble%2Fviz..rkt%29._hist%29%29" class="RktValLink" data-pltdoc="x">hist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mh-or</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_6.png" alt="image" width="406" height="406"/></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mh-n-flips</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="RktStxLink" data-pltdoc="x">mh-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-heads</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._verbose~3f%29%29" class="RktValLink" data-pltdoc="x">verbose?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mh-n-flips</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr"># Starting transition (rerun-mh-transition%)</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 81) = 0</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 42 81) = 0</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 42 42 81) = 0</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">NEW (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># accept threshold = +inf.0</span></p></td></tr><tr><td><p><span class="RktErr"># Accepted MH step with 0.6835961223551988</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">7</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._verbose~3f%29%29" class="RktValLink" data-pltdoc="x">verbose?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mh-n-flips</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr"># Starting transition (single-site-mh-transition%)</span></p></td></tr><tr><td><p><span class="RktErr"># key to change = (1 3 41 42 42 42 42 42 42 42 42 81)</span></p></td></tr><tr><td><p><span class="RktErr"># DRIFTED from 0 to 1</span></p></td></tr><tr><td><p><span class="RktErr"># PROPOSED from 0 to 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">R/F = 1.0</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 81) = 0</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 42 42 81) = 0</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">PERTURBED (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">REUSED (bernoulli-dist 1/2): (1 3 41 42 42 42 42 42 42 42 42 42 81) = 1</span></p></td></tr><tr><td><p><span class="RktErr"># accept threshold = 1.0</span></p></td></tr><tr><td><p><span class="RktErr"># Accepted MH step with 0.9490337808148532</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">8</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="viz.html#%28def._%28%28lib._gamble%2Fviz..rkt%29._hist%29%29" class="RktValLink" data-pltdoc="x">hist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mh-n-flips</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_7.png" alt="image" width="406" height="406"/></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="viz.html#%28def._%28%28lib._gamble%2Fviz..rkt%29._hist%29%29" class="RktValLink" data-pltdoc="x">hist</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mh-n-flips</span><span class="hspace">&nbsp;</span><span class="RktVal">2000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_8.png" alt="image" width="406" height="406"/></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._hmc-sampler))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._hmc-sampler%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">hmc-sampler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">def/expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">result-expr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">maybe-epsilon-clause</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-L-clause</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-when-clause</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-epsilon-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:epsilon</span><span class="hspace">&nbsp;</span><span class="RktVar">epsilon-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-L-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:L</span><span class="hspace">&nbsp;</span><span class="RktVar">L-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-when-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktVar">cond-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Equivalent to the following:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._mh-sampler%29%29" class="RktStxLink" data-pltdoc="x">mh-sampler</a></span><span class="hspace">&nbsp;</span><span class="RktVar">def/expr</span><span class="hspace">&nbsp;</span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktVar">result-expr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktSym">condition-expr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._hmc%29%29" class="RktValLink" data-pltdoc="x">hmc</a></span><span class="hspace">&nbsp;</span><span class="RktVar">epsilon-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">L-expr</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h5>5.3.1<tt>&nbsp;</tt><a name="(part._mh-transitions)"></a>Metropolis-Hastings Transitions</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._mh-transition~3f))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">mh-transition?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> represents a <a href="solvers.html#%28tech._mh._transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">MH transition</span></a>,
<span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._single-site))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._single-site%29%29" class="RktValDef RktValLink" data-pltdoc="x">single-site</a></span></span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktVar">proposal</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:zone</span><span class="hspace">&nbsp;</span><span class="RktVar">zone-pattern</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:record-obs?</span><span class="hspace">&nbsp;</span><span class="RktVar">record-obs?</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></td></tr></table></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">proposal</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._default-proposal%29%29" class="RktValLink" data-pltdoc="x">default-proposal</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">zone-pattern</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">record-obs?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#t</span></td></tr></table></blockquote></div><div class="SIntrapara">A transition that proposes a new state by randomly (uniformly)
selecting a single random choice in any zone matching
<span class="RktVar">zone-pattern</span> and perturbing it according to <span class="RktVar">proposal</span>
(see <a href="solvers.html#%28part._mh-proposals%29" data-pltdoc="x">Metropolis-Hastings Proposals</a>).</div></p><p>A <a name="(tech._zone._pattern)"></a><span style="font-style: italic">zone pattern</span> matches a zone if the two values are
<span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span> or if the zone pattern is <span class="RktVal">#f</span>.</p><p>If the set of observations in the probabilistic program is always the
same (that is, the parameters may change, but the number of
observations and the observed values stay the same), then it is safe
to set <span class="RktVar">record-obs?</span> to <span class="RktVal">#f</span> to avoid creating database
entries for observations. This can improve the efficiency of typical
programs. If the observation set changes from run to run, however,
then <span class="RktVar">record-obs?</span> must be <span class="RktVal">#t</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._multi-site))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._multi-site%29%29" class="RktValDef RktValLink" data-pltdoc="x">multi-site</a></span></span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktVar">proposal</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:zone</span><span class="hspace">&nbsp;</span><span class="RktVar">zone-pattern</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:record-obs?</span><span class="hspace">&nbsp;</span><span class="RktVar">record-obs?</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></td></tr></table></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">proposal</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._default-proposal%29%29" class="RktValLink" data-pltdoc="x">default-proposal</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">zone-pattern</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">record-obs?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#t</span></td></tr></table></blockquote></div><div class="SIntrapara">A transition that proposes a new state by perturbing <span style="font-style: italic">all</span> random
choices in all zones matching <span class="RktVar">zone-pattern</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._slice))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._slice%29%29" class="RktValDef RktValLink" data-pltdoc="x">slice</a></span></span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:scale</span><span class="hspace">&nbsp;</span><span class="RktVar">scale-factor</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:zone</span><span class="hspace">&nbsp;</span><span class="RktVar">zone-pattern</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">scale-factor</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._~3e%2Fc%29%29" class="RktValLink" data-pltdoc="x">&gt;/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">zone-pattern</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">A transition that picks a new state via slice sampling  on a single random choice selected randomly from any zone
<a href="solvers.html#%28tech._zone._pattern%29" data-pltdoc="x">matching</a> <span class="RktVar">zone-pattern</span>.</div></p><p>The <span class="RktVar">scale-factor</span> argument controls the width parameter used
to find the slice bounds.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._enumerative-gibbs))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._enumerative-gibbs%29%29" class="RktValDef RktValLink" data-pltdoc="x">enumerative-gibbs</a></span></span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:zone</span><span class="hspace">&nbsp;</span><span class="RktVar">zone-pattern</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:record-obs?</span><span class="hspace">&nbsp;</span><span class="RktVar">record-obs?</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">zone-pattern</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">record-obs?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#t</span></td></tr></table></blockquote></div><div class="SIntrapara">A transition that chooses a single random choice from a zone matching
<span class="RktVar">zone-pattern</span> and resamples it from its full conditional
probability distribution given the values of all of the other choices
in the program. The distribution of the choice to be perturbed must be
finite; otherwise, an error is raised. The choice to be perturbed must
be <span style="font-style: italic">non-structural</span>&#8212;<wbr></wbr>that is, its value must not determine
whether subsequent choices are made or not&#8212;<wbr></wbr>otherwise, an error is
raised.</div></p><p>Note: unlike traditional Gibbs sampling, this transition picks a
choice at random rather than perturbing all choices round-robin.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._hmc))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._hmc%29%29" class="RktValDef RktValLink" data-pltdoc="x">hmc</a></span></span><span class="hspace">&nbsp;</span>[<span class="RktVar">epsilon</span><span class="hspace">&nbsp;</span><span class="RktVar">L</span><span class="hspace">&nbsp;</span><span class="RktPn">#:zone</span><span class="hspace">&nbsp;</span><span class="RktVar">zone-pattern</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">epsilon</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._~3e%2Fc%29%29" class="RktValLink" data-pltdoc="x">&gt;/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0.01</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">L</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-positive-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-positive-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">10</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">zone-pattern</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">A transition that picks a new state via HMC: Hybrid (or Hamiltonian)
Monte Carlo. HMC is based on Hamiltonian mechanics using the negative
log-likelihood of a state as its potential energy.</div></p><p>This transition is <span style="font-weight: bold">experimental</span> and comes with a number of
restrictions:</p><ul><li><p>There must be no structural dependencies among the distributions
of <span class="RktSym">def/expr</span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="stt"> </span><span class="RktSym">result-expr</span></p></li><li><p>All the distributions must be continuous.</p></li><li><p>Any distribution that has parameters that depend on the value of
another distribution must be wrapped in a <span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span>
form. See <a href="solvers.html#%28part._hmc-utils%29" data-pltdoc="x">Specifying Derivatives for HMC</a> for more information.</p></li></ul><p>The parameters <span class="RktVar">epsilon</span> and <span class="RktVar">L</span> specify the size of
each Hamiltonian step and the number of Hamiltonian steps to take in
the course of obtaining a sample, respectively.  Note that careful
tuning may be required to achive good results.</p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">one-dim-loc-hmc</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._hmc-sampler%29%29" class="RktStxLink" data-pltdoc="x">hmc-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Hid</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">label</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Hid</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._normal%29%29" class="RktValLink" data-pltdoc="x">normal</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="primitive.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._observe-sample%29%29" class="RktValLink" data-pltdoc="x">observe-sample</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="dist.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._normal-dist%29%29" class="RktValLink" data-pltdoc="x">normal-dist</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Hid</span><span class="hspace">&nbsp;</span><span class="RktVal">0.5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9.0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Hid</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">hid</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">Hid</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:epsilon</span><span class="hspace">&nbsp;</span><span class="RktVal">0.01</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:L</span><span class="hspace">&nbsp;</span><span class="RktVal">90</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">bin</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._repeat%29%29" class="RktValLink" data-pltdoc="x">repeat</a></span><span class="hspace">&nbsp;</span><span class="RktSym">one-dim-loc-hmc</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">min: contract violation</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: real?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">given: #&lt;void&gt;</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">argument position: 3rd</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">other arguments...:... [100 total] ...</span></p></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._cycle))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._cycle%29%29" class="RktValDef RktValLink" data-pltdoc="x">cycle</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">tx</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">tx</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a transition that uses an endless cycle of the <span class="RktVar">tx</span>s to
produce samples.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._mixture))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mixture%29%29" class="RktValDef RktValLink" data-pltdoc="x">mixture</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">txs</span><span class="hspace">&nbsp;</span>[<span class="RktVar">weights</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">txs</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">weights</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._~3e%2Fc%29%29" class="RktValLink" data-pltdoc="x">&gt;/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">map</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tx</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">txs</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a transition that randomly selects a transition from
<span class="RktVar">txs</span>, weighted by <span class="RktVar">weights</span>, on each step.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._rerun))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._rerun%29%29" class="RktValDef RktValLink" data-pltdoc="x">rerun</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._mh-transition~3f%29%29" class="RktValLink" data-pltdoc="x">mh-transition?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns a transition that just reruns the program with the same state
as the previous execution.</div></p><h5>5.3.2<tt>&nbsp;</tt><a name="(part._mh-proposals)"></a>Metropolis-Hastings Proposals</h5><p>The <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._single-site%29%29" class="RktValLink" data-pltdoc="x">single-site</a></span> and <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._multi-site%29%29" class="RktValLink" data-pltdoc="x">multi-site</a></span> transitions are
parameterized by the proposal distribution used to perturb a single
random choice.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._proposal~3f))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">proposal?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a proposal object, <span class="RktVal">#f</span>
otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._proposal~3aresample))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3aresample%29%29" class="RktValDef RktValLink" data-pltdoc="x">proposal:resample</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns a proposal that chooses the new value of a variable by simply
resampling from the variable&rsquo;s prior distribution.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._proposal~3adrift))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3adrift%29%29" class="RktValDef RktValLink" data-pltdoc="x">proposal:drift</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns a proposal that chooses the new value of a variable by
choosing a value near the current value, with an adaptive variance.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._default-proposal))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._default-proposal%29%29" class="RktValDef RktValLink" data-pltdoc="x">default-proposal</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._default-proposal%29%29" class="RktValDef RktValLink" data-pltdoc="x">default-proposal</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proposal</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proposal</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3f%29%29" class="RktValLink" data-pltdoc="x">proposal?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Parameter for the default proposal used by MH transitions such as
<span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._single-site%29%29" class="RktValLink" data-pltdoc="x">single-site</a></span> and <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._multi-site%29%29" class="RktValLink" data-pltdoc="x">multi-site</a></span>. If the value of the
parameter is a function, it is applied when the transition is created
to get an actual proposal.</div></p><p>The initial value is <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._proposal~3adrift%29%29" class="RktValLink" data-pltdoc="x">proposal:drift</a></span>.</p><h5>5.3.3<tt>&nbsp;</tt><a name="(part._mh-zones)"></a>Zones: Identifying Random Choices</h5><p>Random choices made during the execution of a model can be grouped
into <a name="(tech._zone)"></a><span style="font-style: italic">zones</span> using the <span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._with-zone%29%29" class="RktStxLink" data-pltdoc="x">with-zone</a></span> form. Specialized
transitions can then be assigned to choices based on their membership
in zones.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._with-zone))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._with-zone%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">with-zone</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">zone-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Associate each random choice in the dynamic extent of the evaluation
of the <span class="RktVar">body</span> forms with the zone produced by
<span class="RktVar">zone-expr</span>. Any value except <span class="RktVal">#f</span> can identity a zone.</div></p><h5>5.3.4<tt>&nbsp;</tt><a name="(part._hmc-utils)"></a>Specifying Derivatives for HMC</h5><p>The <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._hmc%29%29" class="RktValLink" data-pltdoc="x">hmc</a></span> transition requires that all the distributions in the
model are continuous.  It further requires partial derivatives for
each parameter of the distribution of each random variable in terms of
any previous random variable. Such information is provided using the
<span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span> special form.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._derivative))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">derivative</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">sampling-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">parameter-derivative-clause</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">parameter-derivative-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVar">label-ids</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">partial-fn-expr</span><span class="RktPn">]</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#f</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Annotates the <span class="RktVar">sampling-expr</span> expression with the partial
derivatives of its parameters.</div></p><p>The <span class="RktVar">sampling-expr</span> should be either a call to <span class="RktSym"><a href="primitive.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._sample%29%29" class="RktValLink" data-pltdoc="x">sample</a></span>
or a use of one of the functions from <a href="features.html#%28part._erps%29" data-pltdoc="x">Sampling Convenience Functions</a>.</p><p>There should be as many parameter derivative clauses as there are
parameters of the underlying distribution. Each
<span class="RktVar">parameter-derivative-clause</span> consists of a sequence of labels
of the random variables that the parameter depends on together with a
function that produces the partial derivative of that parameter value
with respect to the listed random variables, given the values of those
random variables. The clause <span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span>, which
indicates that the parameter is independent of all previous random
variables, can be abbreviated as <span class="RktVal">#f</span>.</p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">derivative-example</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._hmc-sampler%29%29" class="RktStxLink" data-pltdoc="x">hmc-sampler</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">label</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">A-lbl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._normal%29%29" class="RktValLink" data-pltdoc="x">normal</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">label</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">B-lbl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._normal%29%29" class="RktValLink" data-pltdoc="x">normal</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._derivative%29%29" class="RktStxLink" data-pltdoc="x">derivative</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._normal%29%29" class="RktValLink" data-pltdoc="x">normal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">A-lbl</span><span class="hspace">&nbsp;</span><span class="RktSym">B-lbl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">B</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td></td></tr></table></td></tr></table></blockquote></td></tr></table></p><p>In the example above, <span class="RktSym">A</span> and <span class="RktSym">B</span> do not depend on any
other random variables, so the derivatives of their parameters are
zero (shorthand: <span class="RktVal">#f</span>). The mean (first parameter) of
<span class="RktSym">C</span>, on the other hand, depends on both <span class="RktSym">A</span> and
<span class="RktSym">B</span>, so its derivative clause lists their labels, and the
function returns two values: the partial derivative of <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktSym">A</span><span class="stt"> </span><span class="RktSym">A</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktSym">B</span><span class="stt"> </span><span class="RktSym">B</span><span class="RktPn">)</span><span class="RktPn">)</span> with respect to <span class="RktSym">A</span> and <span class="RktSym">B</span>, in that order.</p><h4>5.4<tt>&nbsp;</tt><a name="(part._particles)"></a>Particle Filters</h4><p>A <a name="(tech._particle._set)"></a><span style="font-style: italic">particle set</span> consists of a collection of particles, each
of which contains a current state estimate and a likelihood
weight. Particle sets are updated via a (stochastic) state transformer
that produces a new state for each particle. Observations performed by
the state transformer adjust the particles&rsquo; weights.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles~3f))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a <a href="solvers.html#%28tech._particle._set%29" class="techoutside" data-pltdoc="x"><span class="techinside">particle set</span></a>,
<span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._make-particles))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._make-particles%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-particles</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span><span class="RktVar">init-state</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">init-state</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a particle set with <span class="RktVar">n</span> particles, each with state
<span class="RktVar">init-state</span> and weight <span class="RktVal">1</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-count))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-count%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-count</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the number of particles in <span class="RktVar">ps</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-update))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-update%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-update</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span><span class="RktVar">update-state</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">update-state</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Produces a new particle set where each particle corresponds to a
particle in <span class="RktVar">ps</span>, where each new particle&rsquo;s state is the result
of applying <span class="RktVar">update-state</span> to the old state. Each new particle&rsquo;s
weight is the old particle&rsquo;s weight adjusted by observations performed
by <span class="RktVar">update-state</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-score))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-score%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-score</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span><span class="RktVar">score-state</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">score-state</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-update%29%29" class="RktValLink" data-pltdoc="x">particles-update</a></span>, but the result of the
<span class="RktVar">score-state</span> function is ignored and the state of each
particle is unchanged. Observations performed by <span class="RktVar">score-state</span>
still affect the new particles&rsquo; weights.</div></p><p>Equivalent to <span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-update%29%29" class="RktValLink" data-pltdoc="x">particles-update</a></span><span class="stt"> </span><span class="RktVar">ps</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">st</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">score-state</span><span class="stt"> </span><span class="RktSym">st</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">st</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-resample))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-resample%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-resample</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>[<span class="RktVar">n</span><span class="hspace">&nbsp;</span><span class="RktPn">#:alg</span><span class="hspace">&nbsp;</span><span class="RktVar">algorithm</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-count%29%29" class="RktValLink" data-pltdoc="x">particles-count</a></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">algorithm</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">multinomial</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">residual</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">multinomial</span></td></tr></table></blockquote></div><div class="SIntrapara">Produces a new particle set by resampling particles from
<span class="RktVar">ps</span>. Every particle in the new particle set has weight
<span class="RktVal">1</span>. See also <span class="RktSym"><a href="util.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._resample%29%29" class="RktValLink" data-pltdoc="x">resample</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-effective-count))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-effective-count%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-effective-count</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._real~3f%29%29" class="RktValLink" data-pltdoc="x">real?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-effective-ratio))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-effective-ratio%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-effective-ratio</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._real~3f%29%29" class="RktValLink" data-pltdoc="x">real?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Returns an estimate of the effective sample size and its ratio to the
number of particles, respectively.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-weighted-states))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-weighted-states%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-weighted-states</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fvector..rkt%29._vectorof%29%29" class="RktValLink" data-pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._cons%2Fc%29%29" class="RktValLink" data-pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._~3e%2Fc%29%29" class="RktValLink" data-pltdoc="x">&gt;/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a vector of the particle states and weights from
<span class="RktVar">ps</span>. Particles with zero weight are omitted, so the length of
the vector may be less than <span class="RktPn">(</span><span class="RktSym">particle-count</span><span class="stt"> </span><span class="RktVar">ps</span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._particles-states))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-states%29%29" class="RktValDef RktValLink" data-pltdoc="x">particles-states</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector~3f%29%29" class="RktValLink" data-pltdoc="x">vector?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a vector of the particle states from <span class="RktVar">ps</span>, regardless
of weight (except that particles with zero weight are omitted).</div></p><p>In general, it is only sensible to call this function when the weights
are known to be equal, such as after calling <span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles-resample%29%29" class="RktValLink" data-pltdoc="x">particles-resample</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._gamble/main..rkt)._in-particles))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._in-particles%29%29" class="RktValDef RktValLink" data-pltdoc="x">in-particles</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ps</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._sequence~3f%29%29" class="RktValLink" data-pltdoc="x">sequence?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ps</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="solvers.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._particles~3f%29%29" class="RktValLink" data-pltdoc="x">particles?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Produces a sequence where each step produces two values: the particle
state and its weight. Particles with empty weights are omitted from
the sequence.</div></p><h4>5.5<tt>&nbsp;</tt><a name="(part._enum)"></a>Enumeration Solver</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._gamble/main..rkt)._enumerate))"></a><span title="Provided from: gamble | Package: gamble"><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">enumerate</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">def/expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">result-expr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">maybe-when-clause</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-limit-clause</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-normalize-clause</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-when-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktVar">condition-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-limit-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:limit</span><span class="hspace">&nbsp;</span><span class="RktVar">limit-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-normalize-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:normalize?</span><span class="hspace">&nbsp;</span><span class="RktVar">normalize?-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Returns a discrete distribution of the form <span class="RktPn">(</span><span class="RktSym"><a href="dist.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._discrete-dist%29%29" class="RktStxLink" data-pltdoc="x">discrete-dist</a></span><span class="stt"> </span><span class="RktPn">[</span><span class="RktVar">value</span><span class="stt"> </span><span class="RktVar">prob</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span>, where <span class="RktVar">value</span> is a value produced by
<span class="RktVar">result-expr</span> and <span class="RktVar">prob</span> is its normalized probability
given <span class="RktVar">condition-expr</span> and the observations in the program. If
<span class="RktVar">normalize?-expr</span> is given and evaluates to <span class="RktVal">#f</span>, then
the probability is unnormalized instead.</div></p><p>The <span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span> form works by exploring all possibilities using
the technique described in [<a href="prob-bibliography.html#%28cite._.E.P.P%29" data-pltdoc="x">EPP</a>]. If <span class="RktVar">limit-expr</span> is
absent or evaluates to <span class="RktVal">#f</span>, then exploration ceases only when
all paths have been explored; if any path is infinite, then
<span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span> fails to terminate.  If <span class="RktVar">limit-expr</span> is
given and evaluates to a probability <span class="RktVar">limit</span>, then exploration
ceases when the error of the normalized result distribution would be
less than <span class="RktVar">limit</span>&#8212;<wbr></wbr>that is, when the unexplored paths have
probability less than <span class="RktVar">limit</span> times the sum of the
probabilities of the paths accepted so far.</p><p>Only discrete and integer-valued distributions can be sampled with
<span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span>, and infinite-range distributions (such as
<span class="RktSym"><a href="dist.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._geometric-dist%29%29" class="RktValLink" data-pltdoc="x">geometric-dist</a></span>) and infinitely-deep recursive functions (such
as <span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._geometric%29%29" class="RktValLink" data-pltdoc="x">geometric</a></span>) require the use of <span class="RktPn">#:limit</span> for
termination.</p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">A</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">B</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">(discrete-dist [#f 1/3] [#t 2/3])</span></p></td></tr></table></blockquote></td></tr></table></p><p>Use <span class="RktPn">#:limit</span> to control when exploration should be cut
off.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">geom</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:limit</span><span class="hspace">&nbsp;</span><span class="RktVal">1e-06</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(discrete-dist</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[0 524288/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[1 262144/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[2 131072/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[3 65536/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[4 32768/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[5 16384/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[6 8192/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[7 4096/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[8 2048/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[9 1024/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[10 512/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[11 256/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[12 128/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[13 64/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[14 32/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[15 16/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[16 8/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[17 4/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[18 2/1048575]</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">[19 1/1048575])</span></p></td></tr></table></td></tr></table></blockquote><p>Use <span class="RktPn">#:normalize?</span><span class="stt"> </span><span class="RktVal">#f</span> to get the result probabilities without
normalizing by the acceptance rate:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="solvers.html#%28form._%28%28lib._gamble%2Fmain..rkt%29._enumerate%29%29" class="RktStxLink" data-pltdoc="x">enumerate</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">drop-coin?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0.9</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">drunk-flips</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._zero~3f%29%29" class="RktValLink" data-pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">drop-coin?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">failed</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="features.html#%28def._%28%28lib._gamble%2Fmain..rkt%29._flip%29%29" class="RktValLink" data-pltdoc="x">flip</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">drunk-flips</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">drunk-flips</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">failed</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">#:normalize?</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">(discrete-measure [#f 0.05263157894736328] [#t 9.765624999999978e-14])</span></p></td></tr></table></blockquote><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="features.html" title="backward to &quot;4 Derived Stochastic Forms and Functions&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Gamble: Probabilistic Programming&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="util.html" title="forward to &quot;6 Utilities&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>